all: graph_lib.so mlperf_lib.so

mlperf_lib.so : mlperf_lars.cu
	nvcc mlperf_lars.cu -o mlperf_lib.so -shared -Xcompiler -fPIC -I/opt/mxnet/include -lmxnet -I/usr/local/cuda/include

graph_lib.so: graph_lib.cc
	g++ graph_lib.cc --std=c++17 -o graph_lib.so -shared -fPIC -DDMLC_LOG_FATAL_THROW=1 -DDMLC_LOG_STACK_TRACE_SIZE=0 -DDMLC_MODERN_THREAD_LOCAL=0 -DDMLC_USE_CXX11=1 -DDMLC_USE_CXX14=1 -DMSHADOW_FORCE_STREAM -DMSHADOW_INT64_TENSOR_SIZE=0 -DMSHADOW_IN_CXX11 -DMSHADOW_USE_CBLAS=1 -DMSHADOW_USE_CUDA=1 -DMSHADOW_USE_CUDNN=1 -DMSHADOW_USE_MKL=0 -DMSHADOW_USE_SSE -DMXNET_USE_BLAS_OPEN=1 -DMXNET_USE_CUDA=1 -DMXNET_USE_INTGEMM=1 -DMXNET_USE_LAPACK=1 -DMXNET_USE_LIBJPEG_TURBO=0 -DMXNET_USE_NCCL=1 -DMXNET_USE_NVTX=1 -DMXNET_USE_OPENCV=1 -DMXNET_USE_OPENMP=1 -DMXNET_USE_OPERATOR_TUNING=1 -DMXNET_USE_SIGNAL_HANDLER=1 -DMXNET_USE_TENSORRT=1 -DNDEBUG=1 -DONNX_ML=1 -DONNX_NAMESPACE=onnx -DUSE_CUDNN -I/opt/mxnet/include -lmxnet -I/usr/local/cuda/include

